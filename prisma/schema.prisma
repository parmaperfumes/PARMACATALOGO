generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model HeaderConfig {
  id        String    @id @default("main")
  logoText  String?   @default("parma")
  logoImage String?
  navLinks  Json?     @default("[]")
  createdAt DateTime? @default(now()) @db.Timestamp(6)
  updatedAt DateTime? @default(now()) @db.Timestamp(6)
}

model Perfume {
  id              String    @id
  nombre          String
  slug            String    @unique
  descripcion     String?
  precio          Float
  precioDescuento Float?
  imagenPrincipal String
  imagenes        String[]  @default([])
  stock           Int?      @default(0)
  destacado       Boolean?  @default(false)
  activo          Boolean?  @default(true)
  categoriaId     String?
  marcaId         String?
  genero          String?
  volumen         String?
  notas           String[]  @default([])
  sizes           Int[]     @default([])
  createdAt       DateTime? @default(now()) @db.Timestamp(6)
  updatedAt       DateTime? @default(now()) @db.Timestamp(6)
  subtitulo       String?
  usoPorDefecto   String?
  fijarUso        Boolean?  @default(false)
  precio30        String?
  precio50        String?

  @@index([activo, destacado], map: "idx_perfume_activo_destacado")
  @@index([categoriaId], map: "idx_perfume_categoria")
  @@index([marcaId], map: "idx_perfume_marca")
  @@index([slug], map: "idx_perfume_slug")
}

model User {
  id           String    @id @default(cuid())
  name         String?
  email        String    @unique
  passwordHash String?
  role         String    @default("PUBLIC")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@index([email])
}

model Visita {
  id          String   @id @default(cuid())
  path        String
  userAgent   String?
  referrer    String?
  ip          String?
  pais        String?
  ciudad      String?
  dispositivo String?
  createdAt   DateTime @default(now())

  @@index([createdAt])
  @@index([dispositivo])
  @@index([path])
}

model eventos_carrito {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tipo           String    @db.VarChar(50)
  cantidad_items Int       @default(0)
  items          Json?
  dispositivo    String?   @db.VarChar(20)
  pais           String?   @db.VarChar(100)
  ciudad         String?   @db.VarChar(100)
  createdat      DateTime? @default(now()) @db.Timestamptz(6)

  @@index([createdat], map: "idx_eventos_carrito_fecha")
  @@index([tipo], map: "idx_eventos_carrito_tipo")
  @@index([tipo, createdat], map: "idx_eventos_carrito_tipo_fecha")
}
